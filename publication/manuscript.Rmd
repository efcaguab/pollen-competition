---
title: "The pollination trade-off"
author: "Fernando Cagua, Hugo Marrero, Jason Tylianakis, Daniel Stouffer"
bibliography: references.bib
csl: ecology-letters.csl
output: 
  bookdown::pdf_document2: 
    keep_tex: yes
    number_sections: false
toc: false
header-includes:
  - \usepackage{booktabs}
  - \usepackage{setspace}
  - \usepackage{lineno}
  - \usepackage{xr}
  - \externaldocument[S-]{supp_info}
---

\linenumbers
\doublespacing
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, 
                      warning = FALSE)
options(xtable.comment = FALSE, 
        xtable.caption.placement = 'bottom',
        xtable.size = 'small',
        booktabs = TRUE)
```

## Abstract

## Introduction

## Methods

### Data collection

We performed sampling in three locations, each located in a distinct phytogeograohic region of the Argentinean Pampas. 
The sampling locations are distributed across a gradient of precipitation with a humid temperate climate in the eastward Flooding Pampas and an drier as we move inland and westward towards the Pampean Grasslands.
Across all sites, annual mean temperatures range between 14.8 and 15.8 Celsius. 

In each location, we sampled two restored and two agricultural fragments. 
However, due to the lack of available sites in the Flooding Pampas, it was only possible to sample one restored site.
We visited each fragment in November 2010 and February 2011. 
In each of these visits we gathered information related to abundance, plant-pollinator visitation, pollen transfer, and pollen deposition.

Abbundance was estimated using two 50 m randomly located transects in each fragment. In a first sampling we counted all units of floral attraction taht were found in a 2 m wide strip. In a second sampling we counted and collected all floral visitors while walking at a pace of 10 m per minute [@Marrero2014; @Memmott1999]. 
We constructed quantitative visitation networks using information about the floral visitors collected during abundance transects [@Marrero2014]. 
In addition, we also constructed qualitative visitation networks during independent two hour observations of floral visits across each fragment.
We estimated pollen transfer by examining the pollen loads present on the collected floral visitors [@Marrero2017]. 
Where the pollen count on an individual was estimated to be less than 2,000 grains, we identified every grain to the species level whenever possible and to pollen complexes when it was not. 
When the pollen count was above 2,000 grains, we clasified approx. 50% of pollen and total pollen counts were extrapollated [@Bosch2009]. 
If more than 10 pollen grains from a plant species were identified, we assumed that pollination service between the plant and the pollinator existed. 
Finally, we analised pollen deposition in a subset of the plant community [@Marrero2016]. 
This subset comprised between three and nine of the most common entomophilus species that were flowering during the samplimg period while ensuring that the chosen species covered a wide range on a specialization-generalization gradient. 
In the selected plants we removed all flowers except buds that were expected to go into inflorecense on the next day. 
A quarter of these buds were bagged to prevent animal pollination. 
Two days after inflorecense, we analysed the pollen grains in the flowers' pistils and classified them between conspecific and heterospecific pollen. 

More details about the study sites, data collection, and laboratory protocols can be found in Marrero *et al.* (2014, 2016, and 2017).

### Data analysis

First, we explored wether animal pollination resulted in a quantitative increase in the pollination service.
To do that, we compared the amount of conspecific pollen on stigmas from flowers open to animal pollination and that from flowers that were bagged, where only autogamus self-pollination ocurred.
The difference between these two counts is not directly equivalent to the pollen deposited by animals because self-pollination is an adaptive trait [@Kalisz2003]. 
Nevertheless, this difference still provides valuable indication of what the animal contribution to reproductive output.
We performed this comparisons using a set of non parametric Mann-Whitney tests both at the community and the the species level (grouping species across communities). 

Our main aim was to examine the extent to which the pollination service was influenced by the number of pollination partners while accounting for other metrics that describe the plant's pollination niche and community composition. 
To do so, we fitted four sets of linear mixed models [using the R package `nlme 3.1-131`, @nlme2017] which differed on whether the pollen deposited was conspecific or heterospecific and on wether independent variables were calculated across communities or independently within each community. 
In all set of models, our response variable was the difference between pollen density (pollen counts per stigma) between open and bagged flowers. 
All together the results from each model set—and the relationship between them—provide with two important pieces of information. 
First,  they provide indication of both the quantity and quality of animal pollination, and the potential trade-off between these two. 
Second, it allowed us to examine wether indeed community level information is necessary to explain the observed patterms or whether less granular data is sufficient. 

All model sets were based on the same one hundred bootstrap resamples of the deposition data. 
We used bootstrap resampling because, as open and bagged flowers were not paired, this allowed us to directly model the *gain* in pollen density rather than density itself. 
This strategy, not only simplified the model specification and intepretation, but also allowed us to easily evaluate the uncertainity of the model results.  
In each replicate we randomly sampled with replacement a number of open flowers within each community-species combination and an equal number of closed flowers. 
We then log-transformed the pollen densities to improve normality and minimise the impact of outliers (Figure \@ref(S-fig:fig-deposition-logtransformed-or-not) and \@ref(S-fig:fig-deposition-gain-logtransformed-or-not)). 
Finally, we calculated the difference between the pollen density among treatmemts. 
This difference was the response variable in all our models. 

As predictors, we included the species/degree (number of animal partners) as well as other factors that could influence the trade-off. 
Specifically, we included the plants' relative abundance and the temporal niche overlap. 
To calculate the plant's relative abbundance we simply aggregated the flower counts over the study period—either across communities of for each community depending on the model set. 
As with the deposition data, we found that log-transforming the abundance counts drastically improved normality (Figure \@ref(S-fig:fig-abundance-logtransformed-or-not)).
We then the log-transformed abundance counts for each month between November 2010 and March 2011 to calculate the temporal niche overlap between plants. 
Specifically, we used the Pianka's niche overlap index [@Pianka1973; `spaa 0.2.2` R package @Zhang2016] which calculates an overlap index for each pair of species—again, across and within  communities depending on the model set. 
To calculate an overlap metric per species, we simply averaged the pairwise indices for a species. 
To faciliate comparison across model estimates, we scaled all independent variables to have a mean of zero and a standard deviation of one. 

In all set of models we first evaluated a set of candidate random effects which included random intercepts for plant species as well as random slopes for the relationship between degree and pollen gain. 
In addition we also tested random intercepts assuming that the plant species grouping was hierachically nested in either their community, the land use, and the locality. 
We selected the best random structure by comparing the median Akaike Information Criterion (AIC) of evaluated models fitted using restricted maximum likelyhood. 
After determining the best random structure, we then focused on the model's fixed structure where we fitted the fixed effect coefficients using maximum likelyhood. 
Because our purpose was to perform inter-model comparisons across multiple data resamples, we did not perform model selection. 
Instead, in all model sets, we obtained the estimates for all the fixed effects we considered and then evaluated their relevance by examining their distribution. 

We compared the performance of the within and across communities model sets using the root-mean-square error normalised by the interquartile range (NRMSE). 
We tested the significance of this difference using a two sample paired Wilcoxon signed rank test for conspecific and heterospecific pollen models. 
We chosed NRMSE because it provides an easily interpretable metric related to the quality of the predictions while being farily insensitive to sample size. 
This inensitivity was desirable because the across communities models had often slightly larger sample sizes owing to the fact of some species not having all data necessary to calculate the independent variables at the community level.

Finally, we focused on how the pollination trade-off was related to our explanatory variables. 
To do so, we harnessed the results from the conspecific and heterospecific pollen models that performed best (across or within communities). 
To examine the relationship between these model sets, we sampled 100 estimates from the distribution of coefficients in each set. 
For each of the samples, we then calculated the difference between the gain in conspecific and heterospecific pollen that would be predicted assuming mean values for the random intercepts and the other predictors.  

## Results

```{r differences-in-self-pollination}
loadd(significant_gain_global, significant_gain_site)

sgg <- glance_table(significant_gain_global)
prop_sig_global <- sum(sgg$p.value < 0.05) /
  length(significant_gain_global)
sgs <- glance_table(significant_gain_site)
prop_sig_site <- sum(sgs$p.value < 0.05) /
  length(significant_gain_site)

consistency <- inner_join(sgg, sgs, by = 'recipient') %>% 
  mutate_at(.vars = c('p.value.x', 'p.value.y'), 
            .funs = function(x) x < 0.05) %>%
  mutate(consistent = p.value.x == p.value.y) %>%
  group_by(recipient) %>%
  summarise(p.value.x = mean(p.value.x), 
            consistent = all(consistent),
            n_sites = n_distinct(site_name)) %>% 
  filter(n_sites > 1)
prop_consistency <- sum(consistency$consistent)/
  nrow(consistency)
```

Over all study sites, we found that `r round(prop_sig_global*100)`% of species observed a significant increasse (at the $\alpha = 0.05$ level) in pollen density when comparing open and bagged flowers (Table \@ref(S-tab:table-species-gain-global)). 
When looking at the differences within sites, we found that only `r round(prop_consistency*100)`% of the species that were present in more than one site had the same response across community (Table \@ref(S-tab:table-species-gain-site)). 
Despite these differences, the community had a comparatively small effect on wether animal pollination increased the pollen density or not (Table \@ref(S-tab:table-variation-across-sites)). 

We found that the random structure that was best supported the data was consistently the one that included plant species nested in community as the grouping factors (Table \@ref(S-tab:table-aic-random-models)). 
When comparing the performance of the models constructed at the community or study-wide level we found that the gain in conspecific pollen was better approximated by the model sets using predictors calculated across communities (Table \@ref(S-tab:table-global-vs-community-models)). 
This was so despite the fact that the model predictors calculated at the community level were highly correlated to those at the study wide level (Figure \@ref(S-fig:fig-global-community-correlations)). 
Nevertheless, results from the within community models are similar both qualitatively and quantitatively (with the exception of phenology overlap, but that might change once I use a better metric, Figure \@ref(S-fig:fig-model-results)). 

We found that the number of species a plant interacts with (the species degree) is positively correlated with the heterospecific pollen density deposited.
To a smaller extent, degree is also negatively correlated with the density of conspecific pollen.

```{r fig-model-results-global, fig.height = 2, fig.cap = "Model coefficients"}
loadd(tidied_fixed, sites)

tidied_fixed %>%
  filter(term != "(Intercept)" , 
         var_trans == 'log',
         scale == "global"
         ) %>%
  group_by(pollen_category,scale, model, var_trans, term) %>%
  summarise(estimate = first(estimate)) %>%
  group_by() %>%
  humanize() %>%
  ggplot(aes(x = estimate, 
             colour = pollen_category, 
             fill = pollen_category)) +
  geom_vline(xintercept = 0, linetype = 2, size = 0.25) +
  stat_density(geom = 'area',
               alpha = 0.15,
               position = position_identity(),
               draw_quantiles = c(0.5, 0.95, 0.05), 
               trim = F, 
               scale = "count",
               bins = 15) +
  pub_theme() +
  facet_grid( ~ term, scales = "free_x", space = "free_x") +
  scale_color_manual(values = colour_scale_values) +
  scale_fill_manual(values = colour_scale_values) +
  scale_x_continuous(breaks = seq(-2,2, by = 0.25)) + 
  theme(legend.position = "top") +
  labs(colour = "", fill = "")
```


```{r fig-trade-off-predictions, fig.width=3.5, fig.height= 2.5, fig.cap = "Trade off predictions"}
loadd(trade_off_predictions)

trade_off_predictions %>%
  mutate_at(c("conspecific", "heterospecific"), exp) %>%
  mutate(gain = conspecific / (conspecific + heterospecific)) %>%
  filter(!(value > 2.2 & term == "k")) %>%
  humanize() %>%
  ggplot(aes(x = value, y = gain, colour = term)) +
  geom_hline(yintercept = 0.5, size = 0.25, linetype = 2) + 
  geom_point(shape = 21, alpha = 0.5, size = 1) +
  geom_smooth(aes(fill = term), 
              se = F, size = 0.5, method = "glm", 
              method.args = list(family = "binomial"), alpha = 0.1)+
  pub_theme() +
  scale_color_manual(values = colour_scale_values) +  
  scale_fill_manual(values = colour_scale_values) +
  theme(legend.position = "top") +
  labs(colour = "", fill = "", 
       y = "scaled trade-off\nconspecific - heterospecific pollen gain", 
       x = "scaled variable value")
```

## Discussion 

This is, the data is best modelled when ignoring the hierarchical nature of the experiment (communities nested in agricultural or restored fragments nested in localities).
Similarly, the relationship between degre and pollen gain does not seem to be species or community dependent. 

Relative small difference between conspecific animal and self pollination is conservative because crossing is better than cloning ()

## Awknowledgements

## References
