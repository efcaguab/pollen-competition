---
title: "The pollination trade-off"
author: "Fernando Cagua^1^, Hugo Marrero^2^, Jason Tylianakis^1^, Daniel Stouffer^1^"
bibliography: phd-bibliography/pollen-competition.bib
csl: ecology-letters.csl
output: 
  bookdown::pdf_document2: 
    keep_tex: yes
    number_sections: false
toc: false
header-includes:
  - \usepackage{booktabs}
  - \usepackage{setspace}
  - \usepackage{lineno}
  - \usepackage{xr}
  - \newcommand{\R}[1]{\label{#1}\linelabel{#1}}
  - \newcommand{\lr}[1]{page~\pageref{#1}, line~\lineref{#1}}
  - \externaldocument[S-]{supp-info}
---

\linenumbers
\doublespacing
 
^1^ Centre for Integrative Ecology, School of Biological Sciences, University of Canterbury, Private Bag 4800, Christchurch 8041, New Zealand

^2^ Centro de Recursos Naturales Renovables de las Zonas Semiáridas, CONICET, Camino de la Carrindanga Km. 7, 8000 Bahía Blanca, Argentina

**Author for correspondence:** E. Fernando Cagua (efc29@uclive.ac.nz) - Centre for Integrative Ecology, School of Biological Sciences, University of Canterbury, Private Bag 4800, Christchurch 8140, New Zealand

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, 
                      warning = FALSE)
```

```{r draft-details}
drake::loadd(msc_wordcount, abs_wordcount)
```

**Manuscript length:** `r format(msc_wordcount$n_char_tot_stri, big.mark = ",")` characters, approx. `r format(round(msc_wordcount$n_words_stri/10)*10, big.mark = ",")` words (excludes front-matter, abstract, awknoledgements, references, and figure/table legends); `r msc_wordcount$reading_time_stri` min. reading time.

**Abstract length:** `r abs_wordcount$n_words_stri` words.

\clearpage

# Draft Info

## Changes

* Now using AICc instead of AIC to evaluate models (no change in results)
* Traits: (*a*) to keep signature of phenology, absolute flower counts (log-transformed) are used instead of relative abundances. Also, now (*b*) columns in the trait matrix for phenology are scaled so that it doesn't count 5 times as much as other traits.
* The absolute/relative/gain terminology was confusing. Now  I'm modelling open and bagged pollen counts directly, using the bagged as a sort of control.
* Introduced visit effectiveness instead of the share in the pollen pool as a predictor in the model. Turns out to be a better predictor and also incorporates quantitative visitation data which was missing from the previous models. 
* Now I use a PCA of the explanatory variables to understand different plant strategies and give a deeper treatment to the facilitation/competition question. 

## Todo

* Polish discussion. 
* Spell-check everything & check that reference list is correct.
* I think its not supper clear in the manuscript what is meant by a plant strategy. Need to re-check in the next iteration. 

## Questions

Feel free to come back here after you've read the manuscript. Thanks!

* Journal?
* I think the story is still a bit disperse. Will appreciate feedback on identifying the most important/exciting findings to tie the others around it. So far the central topic is scaling up of competition to the community level. 
* Do you know of a reasonable reference for the claims in \lr{ref-needed-possitive-loops} and \lr{ref2}?
* Hugo. Some journals require publication of data alongside with the paper. Is it OK to consider those? Or you prefer to keep data private?
* In Figure \@ref(fig:fig-trade-off-predictions)a, I determine if the slope is significantly positive or negative by checking whether the standard errors cross 0. Should it be 2 times SE? Should all other error bars in Figure \@ref(fig:fig-trade-off-predictions) be 2 times SE?
* What do you think about the quantity/quality discourse now? I'm still unconvinced. Maybe I should just go for relationship conspecific/heterospecific instead of quality? That would mean that Figure \@ref(fig:fig-average-qual-quant)c would just need the right panel. Cause the left is just almost the same as Figure \@ref(fig:fig-average-qual-quant)b, except that it includes models in which the variable was not present and hence "shrinks" the model averaged estimate.  
* Unsure of whether in Figure \@ref(fig:fig-pca)a, it would be better to display the contribution of each component to total variance instead of the cummulative contribution.
* I'm not very happy with the way the third hypothesis is described in the intro (\lr{third-hypothesis}). I would appreciate ideas to rephrase it clearly
* Does the paragraph in \lr{disc-facil-comp} needs more meat? Any suggestions?
* My background in the topic is limited, would be grateful if you could point me out to key papers that could be used to put some context to the finding of the "flexibility" of plants strategies (paragraph in \lr{strategies})
* Part of the discussion before revolved about the fact that degree is commonly used in theoretical models of mutualism to adjust the mutualistic benefit of generalist species. I've removed it because I think the discussion is already a bit long and didn't fit that nicely in the story. You think it should be included? 

\clearpage

# Abstract

`r paste(drake::readd(abstract), collapse = "")`

**Keywords:** X, Y, Z 

\clearpage

# Introduction

Animal pollination systems play a disproportionally important role in food production and maintenance of global biodiversity [@bascompte_plant-animal_2007; @klein_importance_2007; @ollerton_how_2011]. 
Alongside the direct mutualisms between plants and their pollinators, \R{ref-needed-possitive-loops} the support to biodiversity can be achieved as a result of inter-species facilitation—the positive feedback loops that exist between plants that share pollinators or pollinators that share plant [@moeller_facilitative_2004; @ghazoul_floral_2006; @molina-montenegro_positive_2008]. 
In sum, inter-species facilitation is able to promote species coexistence because it is able to offset the effects of direct competition for resources [@stachowicz_mutualism_2001]. 
What is more, studies that are fundamental to our current knowledge of mutualism predict that the maximum number of coexisting species---effectively an upper limit to biodiversity---is achieved when the number of shared mutualistic partners is maximised in a community [@bastolla_architecture_2009]. 
And yet, not every pollinator species in natural communities interacts with every species of plant. 

One explanation is that sharing a mutualistic partner also has costs [@waser_interspecific_1978]. 
As soon as there are costs, plants start competing for mutualistic partners, even if this competition is not strong enough to produce a net negative effect in fitness. 
It has been clear for a long time [@robertson_philosophy_1895; both experimentally @lewis_experimental_1961 and theoretically @levin_competition_1970] that when competition is strong enough, it can be detrimental to plants' fitness. 
So much so that competition for pollination has been shown to drive ecological differentiation [for example by driving the evolution of of both traits and reproductive strategies; @mitchell_new_2009; @caruso_competition_2000]. 
It is less clear, however, how exactly these strategies of differentiation, in turn, modulate the strength of competition for pollinators. 
<!-- The ecological factors that modulate the strength of competition, andfactors  -->
<!-- In addition, it has been shown that the strength of competition for pollinator can be modulated by multiple ecological factors factors (like the number of shared pollinators, the plants' relative abundance, visitor fidelity, and traits) [@bobisud_pollinator_1975; @mitchell_new_2009; @morales_interspecific_2008; @feinsinger_effects_1987; @campbell_pollinator_1985].  -->

There are two main mechanisms through which factors of ecological differentiation can affect plant fertilization [@morales_interspecific_2008]. 
The first mechanism, is by reducing the number of conspecific pollen grains on stigmas. 
For example, plants with distinctively attractive flowers might reduce the number of visits---and hence the amount of conspecific pollen deposited by animals---for those less attractive [@yang_pollinator_2011]. 
This can be seen as the *quantity* of the pollination service.
More subtly, when plants employ reproductive strategies that imply sharing pollination partners, even receiving a visit might not translate into fertilization.
This so because a focal plant might receive pollen from a different species, or conversely, pollen from the focal plant might be lost to different species. 
This second mechanism, is called interspecific pollen transfer [@campbell_mechanism_1985]. 
Generally speaking, the higher the proportion of conspecific relative to heterospecific pollen the higher the *quality* of the pollination service. 
With few exceptions [@rathcke_interactions_1988; @lopezaraizamikel_impact_2007; @tur_evaluating_2016; @hegland_relative_2009; @aizen_reproductive_2010], most of what we know about the quantity and quality of pollination---and its relationship to competition vs. facilitation in pollination systems---is based mostly on studies of two plant species. 
However, competitive interactions between species pairs do not occur in isolation. 

Instead, co-flowering plants often occur in communities in which the factors that determine differentiation are tightly intertwined,  operate simultaneously, and may lead to phenomena not observed at smaller scales [@flanagan_effects_2011]. 
For instance, recent empirical evidence suggests that plants with flowering traits that are original relative to others in the community have generally fewer interaction partners [@coux_linking_2016]. 
This evidence is aligned with the notion that a species that interacts with few species does so strongly with each of them; in contrast, a species that interacts with a large number of species does so comparatively weakly. 
If evolutionary specialisation occurs by changing traits to focus on fewer but better partners [@caruso_competition_2000], we should expect a reduction of competition for pollinators in species with original traits and an increase in species with a large number of interaction partners [@gibson_can_2012]. 
Alternatively, based on evidence from two/three species systems, it might also be the case that flower/pollen density is the dominant force driving pollen transfer [@seifan_outcome_2014]. 
Abundant plant species might experience a dilution of available pollinators [@feinsinger_effects_1987] but might also receive more effective visits by capitalising on a larger share of both the pollen being transported by pollinators and their visits compared to other species. 
In this case, a potential reduction in the quantity of pollination (the amount of conspecific pollen received) could be compensated by an increase in the quality of pollination (the amount of conspecific relative to heterospecific pollen received). 
<!-- To complicate things more, autonomous self-pollination can also influence a plant sensitivity to competition for pollination because it can ensure reproduction even in the absence of outcross pollen [@kalisz_benefits_2003].  -->
<!-- Altogether, multiple, potentially correlated, factors may act simultaneously.  -->
The effect and relative importance that the factors of ecological differentiation in the plants' communities play on the pollination service has not yet been empirically evaluated in natural communities. 

Here, we investigate competition for pollination at the community scale using comprehensive empirical data from eleven plant-pollinator communities in the Argentinian Pampas. 
First, we need to understand the extent to which the outcome of animal-mediated pollination is facilitation or competition. 
If facilitation is the primary outcome we would expect (*i*) an overall positive relationship between the amount of conspecific pollen deposited in stigmas and the heterospecific pollen [@tur_evaluating_2016] and (*ii*) a larger amount of conspecific pollen deposited in stigmas when flowers are open to animal pollinators than that due to self-pollination. 
Second, we investigate the relative contribution that four ecological factors, that together describe the strategies of ecological differentiation, have on competition for pollination. 
We hypothesize that competition for pollination at the community level should increase as the number of shared pollination partners a plant has increases.
However, other factors like the plant's functional originality, its relative abundance, and the visit effectiveness, should have the potential to compensate this increase in competition by improving either the quality or the quality of pollination. 
Third, and finally, we explore how community context influences the way plants use these factors to minimise competition. 
\R{third-hypothesis}Although some plant species might be widespread across multiple locations, competition for pollinators occurs at the community level and are hence is likely to be defined by the local context. 
If plant species adopt comparable roles across different communities, we should expect plant strategies to be more similar within species than across species in the study. 
On the contrary, if species role is flexible, we should expect plants to be able to adopt different strategies in each community such that competition is minimised depending on the context. 

# Methods

We collected data from eleven co-flowering plant communities and their pollinators in three locations, each in a distinct region of the Argentinian Pampas. 
These locations are distributed across a precipitation gradient with a humid temperate climate in the eastern Flooding Pampas and becoming drier as one moves inland and westward towards the Pampean Grasslands.
Annual mean temperatures range between 14.8 and $44.9^\circ$C. 
In each location, we sampled two restored and two agricultural fragments, except in the Flooding Pampas, where due to the lack of available sites, we were only able to sample one restored fragment.

## Competition vs. facilitation

Our first objective is to identify whether, at the community level, the net outcome of animal-mediated pollination is facilitation or competition. 
The first line of evidence can be found in the relationship between heterospecific and conspecific pollen deposited in plant stigmas [@tur_evaluating_2016]. 
This is so because heterospecific pollen can be seen as a cost that plants must pay for receiving conspecific pollen from shared pollinators. 
A negative relationship (when shared pollinators increase heterospecific pollen loads and decrease conspecific loads) may indicate that competition for pollination is strong. 
This negative relationship could arise, for example, when another, more dominant species, monopolizes a limited number of pollinators [@mitchell_new_2009], when heterospecific pollen deposited in the stigma interferes with deposition of conspecific pollen [@runquist_pollinator-mediated_2012], or when conspecific pollen is lost to heterospecific stigmas [@mitchell_new_2009; @muchhala_interspecific_2012]. 
In contrast, a positive relationship is what should be observed if facilitation is the dominant outcome. 
For example, when the abundance of shared pollinators is positively influenced by floral resources and these positive effects ripple through the mutualistic network in a chain of positive feedback loops [@liao_presence_2011]. 

The second line of evidence could be obtained by examining the difference between the amount conspecific pollen deposited in flower stigmas *with* and *without* animal-mediated pollination. 
Self-pollination can be favourable to plant reproduction when competition for pollination is strong because it provides insurance against a poor pollination service [@kalisz_benefits_2003]. 
If competition for pollination is sufficiently strong, then the amount of conspecific pollen deposited in flower stigmas when animal pollination is prevented could be higher than when floral visits are allowed. 
In contrast, the opposite pattern may indicate that plants benefit from animal-mediated pollination---even a small difference between outcross and self-pollen may be important to plant fitness \R{ref2}[@ref]. 
This is particularly so for species that are not self-fertile or those in which self-fertilization is rarely effective due to a temporary separation in the maturation of the sexes (dichogamy). 

### Data collection

In each of the studied communities, we quantified pollen deposition in a subset of plant species between December 2010 and February 2011. 
This subset comprised of between three and nine common insect-pollinated (entomophilous) species that were flowering during the sampling period (see Figure \@ref(fig:fig-trade-off-predictions)a). 
We chose plant species such that they cover a wide range on a specialization-generalization gradient as well as a wide range of abundances. 
Briefly, in each of the selected plants, we removed all flowers leaving only buds that were expected to go into florescence on the next day. 
Approximately a quarter of these buds were bagged to prevent animal pollination. 
Two days after inflorescence, we counted the pollen grains in the remaining flowers' pistils, classified them between conspecific and heterospecific pollen, and calculated the number of pollen grains per stigma in each flower. 
More details about the study sites and data collection and laboratory protocols can be found in @marrero_agricultural_2016. 

### Data analysis

To evaluate the relationship between heterospecific and conspecific pollen, we used a generalised linear mixed model (GLMM) with a Poisson error distribution in each of our communities [@tur_evaluating_2016]. 
In these models, the number conspecific pollen grains per stigma was the response variable and the number of heterospecific grains the predictor. 
The slope and intercept of this relationship were allowed to differ between plant species, which were modelled as a random effect. 
Models were fitted using the function `lmer` from the R package `lme4 1.1-19` [@bates_fitting_2015]. 
To compare the conspecific pollen deposited with and without animal-mediated pollination, we performed a Mann-Withney U test of the number of conspecific pollen grains per stigma between un-bagged and bagged flowers for each of the studied species in a community. 

## Effect of plant strategies in the pollination service 

Our second objective is to investigate the relative contribution that different factors that describe the plants' strategies to minimise competition have on the pollination service. 
Specifically, we investigate the effect of (*i*) the number of shared pollinators, (*ii*) the plants relative abundance, (*iii*) the mean visit effectiveness---a metric that combines the share of pollen that a plant species is able to place on each of their floral visitors and the number of visits it receives from them (see Data Analysis section below for more details), and (*iv*) the plants functional originality.
Here, we define visit effectiveness of the pollinator species *i* to plant species *j* as the proportion between the visits of *i* to *j* and all visits of *i*, multiplied by the proportion between the number of pollen grains of *j* attached to individuals of *i* and all pollen attached to individuals of *i*.

### Data collection

To obtain the number of shared pollinators for each species (*i*), we collected data to construct qualitative and quantitative pollination networks. 
Qualitative networks were constructed based on two-hour observations of floral visits in each fragment. 
Quantitative networks were constructed using two 50 m randomly located transects in each transect. 
We counted and collected all floral visitors found in a 2 m wide strip while walking at a pace of 10 m per minute [@marrero_effect_2014; @memmott_structure_1999]. 
We visited the transects each month between November 2010 and March 2011. 
To obtain plant abundance (*ii*), we counted all units of floral attraction found during an independent sampling of the same transects used to construct the quantitative visitation networks. 
To estimate visit effectiveness (*iii*), in addition to the visitation networks we need to construct pollen transfer networks. 
To construct the transfer networks we examined the pollen loads present on the collected floral visitors [@marrero_exotic_2017]. 
When the pollen count on an individual animal was estimated to be less than 2,000 grains, we identified every grain to the species level whenever possible, and to pollen complexes when it was not. 
When the pollen count was above 2,000 grains, we classified approx. 50% of pollen and total pollen counts were extrapolated [@bosch_plant-pollinator_2009]. 
Finally, We also recorded morphological traits (*iv*) that relate to plant type (herb, shrub, climber), life cycle (annual, perennial), flower colouration, and whether the species is native in the study region. 
More details about the study sites, data collection, and laboratory protocols can be found in Marrero *et al.* (2014 and 2017).

### Data analysis

We investigate the impact of the ecological strategies on the pollination services using two metrics: the quantity and the quality of pollination. 
Here we define the quality of pollination as the amount of conspecific pollen and the quality of pollination as the amount of conspecific pollen *relative* to heterospecific pollen. 
To construct these metrics we use two sets of linear mixed models (LMM) in which the response variables are the number of conspecific and heterospecific pollen grains deposited per stigma in flowers open to animal-mediated pollination. 
In general, using LMMs in which pollen loads were log-transformed (Figure \@ref(S-fig:fig-deposition-gain-log-transformed-or-not)) offered better results than a GLMM with Poisson (or quasipoisson) error structure. 
Models were fitted using the R package `nlme 3.1-131` [@pinheiro_nlme_2018]. 

Because the amount of deposited pollen can vary widely across species, and potentially also across communities, we evaluated two possible structures for the random effects: one that includes a random intercept for plant species, and one that treats species across different communities independently. 
We selected the best random structure by comparing the median Akaike Information Criterion for small samples (AICc). 

As predictors in the models, we included the four ecological variables described above. 
Specifically, we calculated the number of shared pollinators for each plant species (*i*) by pooling data from the qualitative and quantitative pollination networks. 
This variable is strongly correlated to the number of animal species a plant interacts with (the species degree). 
To calculate the plants' relative abundance in their community (*ii*), we simply aggregated floral counts for each species. 
We then calculated the mean visit effectiveness (*iii*). 
As explained before, we define the effectiveness of a visit by pollinator species *i* to plant species *j* as \[e_{ij} = \frac{v_{ij}}{v_i} \frac{p_{ji}}{p_j}\] where *v~ij~* is the observed number of visits by *i* to *j*, *p~ji~* is the number of pollen grains from *j* attached to *i*, *v~i~* is the total number of visits performed by *i*, and *p~j~* is the total number of grains carried by *j*.
Because the number of interacting species (and therefore the number of shared pollinators), floral abundance, visitation, and pollen production roughly followed a power-law distribution, we log-transformed these three predictors before including them in the model. 

Finally, functional originality (*iv*) is defined as the distance of a species from the community trait average--the centroid of functional space of the community [@laliberte_distance-based_2010; @coux_linking_2016]. 
As phenology has been shown to be a key mechanism of niche differentiation among plants, we also included the plant abundance in each of the survey months (November to March) as an additional trait in our analysis. 
This approach allowed us to integrate the originality in phenological niche alongside the originality on other functional traits. 
However, because floral counts across months are not independent, we assigned them a weight of 1/5 such that phenology has an equal weight as other traits. 
We scaled all traits prior to calculating the centroid of the functional space and calculated the species-specific functional coordinates using the R package `FD 1.0-12` [@laliberte_fd_2014]. 
Finally, to facilitate comparison across the four continuous explanatory variables in our models, we rescaled them all to have a zero mean and unitary variance.

To estimate the coefficients and to perform model selection and the associated uncertainty, we used a combination of multi-model inference and bootstrap resampling with one hundred replicates. 
First, we performed model selection using the AICc and determined the likelihood of each candidate model (a particular combination of predicting variables) by calculating the median \(\Delta\)AICc (relative to the most likely model) for each bootstrap sample. 
As we wanted model coefficients from more likely candidate models to carry more weight in our results, we sampled the coefficients for our variables proportional to the likelihood of its candidate model. 
We "shrank" the estimates coefficient of potentially unimportant variables by setting its estimate to 0 when the variable was not included in the model. 
Finally, we used these distributions of the model coefficients to estimate their impact on the quantity and quality of pollination. 
For the quantity of pollination, we simply calculated the mean value of a sample of the conspecific pollen loads. 
For the quality of pollination, we calculated the mean difference between a sample of the distribution of the effects of conspecific pollen and a sample of those of heterospecific pollen gain.
Again, here we used bootstrap resampling to estimate the uncertainty around these means. 

## Flexibility of plant strategies

Our last objective is to tease apart the strategies that plants might use to reduce competition and, importantly, how the community context influences these strategies. 
If community context plays a relatively small role, we should expect plants to adopt similar strategies across different communities. 
Alternatively, if the community plays a large role, we should be able to observe differences in the strategy a plant species across communities. 
We first use a principal component analysis (PCA) of the four ecological variables. 
We define the species strategy in a community as its coordinates in PCA space. 
For each species that was present in two or more communities, we then calculate (*i*) the median distance between the strategies that the species uses different communities, and (*ii*) the area of the convex hull defined by these points in the first two principal components. 
We then compare these two metrics to those obtained with 99 Monte Carlo randomizations in which we replace the strategy of the focal plant species by one of another species in the dataset.

# Results

## Competition vs. facilitation

```{r facilitation-random-model-stats, echo = F}
drake::loadd(facilitation_plot_df)

# count number of species with positive and negative slopes
counts_facilitation_slope <- facilitation_plot_df %>%
  dplyr::group_by(effect_category) %>%
  dplyr::count() %>%
  dplyr::group_by() %>%
  dplyr::mutate(np = nn/sum(nn), 
                np = round_preserve_sum(np, 2)*100)

# species with both positive and negative relationships
get_sp_with_both_pos_neg <- . %>%
  dplyr::filter(effect_category != "neutral") %>%
  dplyr::group_by(plant_name) %>%
  dplyr::summarise(both = dplyr::n_distinct(effect_category) > 1) %>%
  dplyr::filter(both)
sp_both_pos_neg <- facilitation_plot_df %>%
  get_sp_with_both_pos_neg()

# equal number of negative and positive?
equal_pos_neg <- counts_facilitation_slope$nn[1] == counts_facilitation_slope$nn[3]
```

We first examined the relationship between the heterospecific and conspecific pollen deposited on stigmas of a species in a community. 
We found that the overall slope of the relationship was positive (Table SXX), but a large proportion of plants experienced a negative or no significant relationship between heterospecific and conspecific pollen (`r counts_facilitation_slope$np[1]`% and `r counts_facilitation_slope$np[2]`% respectively; Figure \@ref(fig:fig-trade-off-predictions)a). 
Most of the variation between plants in a facilitation-competition gradient was driven by differences *between* species, however, we also observed some important differences *within* species. 
For instance, `r numbers2words(nrow(sp_both_pos_neg))` of species sampled in multiple communities (*Cypella herbertii*, *Diplotaxis tenuifolia*, *Hirschfeldia incana*, and *Carduus acanthoides*) showed evidence that facilitation (positive relationships) predominates in some communities while competition (negative relationships) predominates in others. 
Furthermore, although there was a wide variation in the slope of the relationship between heterospecific and conspecific pollen, plants, in almost all cases, had more conspecific than heterospecific pollen deposited on their stigmas (Figure \@ref(fig:fig-trade-off-predictions)b). 

```{r fig-trade-off-predictions, fig.height= 4, fig.width = 6.5, fig.cap = "**Competition vs. facilitation at the community level**. (a) Some species experience more competition for pollination than others. Points indicate the estimated slopes for the relationship between the amount of heterospecific and conspecific pollen deposited per stigma across species in their communities. Negative slopes indicate that plants experience competition for animal-mediated pollination, while positive slopes indicate that facilitation is the predominant outcome. The number of plants analysed for each species is shown within brackets next to the species name. (b) Despite the variety of slopes, overall plants had more conspecific than heterospecific pollen deposited in their stigmas. (c) Generally, plants also had more pollen deposited in their stigmas when they were open to animal-mediated pollination than when they were closed. However, in the majority of cases, the difference is not large enough to be statistically significant at the 0.05 level. In all plots, error bars correspond to ± the standard error (SE)."}
# fig_random_slopes <- plot_random_slopes(facilitation_random_effects, dep_frame)
# fig_con_con <- plot_bagged_vs_open_conspecific(dep_frame)
# fig_hetero_con <- make_fig_con_hetero_empirical(dep_frame)
# pdf(width = 6.5, height = 4)
drake::loadd(fig_random_slopes)
drake::loadd(fig_con_con)
drake::loadd(fig_hetero_con)
width_left <- 6.5*3/5
bar_plot_width <- 0.325
rw <- c(width_left - bar_plot_width,
        bar_plot_width, 
        6.5 - width_left - bar_plot_width,
        bar_plot_width)
left <- cowplot::plot_grid(
  fig_hetero_con,
  NULL,
  fig_con_con[[1]],
  fig_con_con[[2]],
  ncol = 2, 
  rel_widths = rw[c(3,4)], 
  align = "h"
)
right <- cowplot::plot_grid(
  fig_random_slopes[[1]],
  fig_random_slopes[[2]], 
  ncol = 2, 
  align = "h", 
  rel_widths = rw[1:2]
)
cowplot::plot_grid(
  right,
  left,
  ncol = 2,
  rel_widths = c(sum(rw[1:2]), sum(rw[3:4]))
)
# dev.off()
```

```{r facilitation-conspecific-stats}
drake::loadd(con_con_plot_df)
# overall counts of possitive/negative
sp_con_con <- con_con_plot_df %>%
  dplyr::group_by(effect_category) %>%
  dplyr::count() %>%
  dplyr::group_by() %>%
  dplyr::mutate(np = n/sum(n), 
                np = round_preserve_sum(np, 2)*100)
# species with contrasting behaviours
sp_con_both_pos_neg <- con_con_plot_df %>%
  get_sp_with_both_pos_neg()
```

Second, we compared the amount of conspecific pollen deposited on flowers that were open to animal-mediated pollinators with those that were closed. 
Here again, we found large differences between plants. 
Specifically, the difference was non-signifcant for `r sp_con_con$np[sp_con_con$effect_category == "neutral"]`% of plants, `r sp_con_con$np[sp_con_con$effect_category == "positive"]`% had significantly more pollen when open, and the remaining `r sp_con_con$np[sp_con_con$effect_category == "negative"]`% had significantly less pollen when open ($\alpha = 0.05$, Mann-Withney U tests; Figure \@ref(fig:fig-trade-off-predictions)c). 
Variation within species was slightly smaller and only `r numbers2words(nrow(sp_con_both_pos_neg))` species (*H. incana* and *C. acanthoides*) had both significantly positive and negative differences. 

## Effect of ecological strategies in the pollination service 

```{r model-fit-statistics}
drake::loadd(model_formula_ranking, glanced_fixed)

r2_values <- model_formula_ranking$by_model_set %>%
  dplyr::filter(grepl("abs", pollen_category)) %>% 
  dplyr::group_by(pollen_category) %>%
  dplyr::filter(delta_AIC_median == min(delta_AIC_median)) %>%
  dplyr::select(fixed_formula, pollen_category, scale) %>%
  dplyr::left_join(glanced_fixed) %>% 
  dplyr::select(r2m, r2c) %>%
  dplyr::summarise_all(dplyr::funs(min, median, mean, max)) %>%
  dplyr::mutate_if(is.numeric, round, digits = 2)
```

We then examined the role that four ecological variables (number of shared pollinators, abundance, mean visit effectiveness, and functional originality) play on pollen deposition and, by extension, in the quantity and quality of pollination. 
These variables define the strategies that plants use to minimise competition for pollination. 
We found that the linear mixed models of pollen deposition used had high explanatory power. 
The conditional coefficient of determination R^2^~(c)~ of the most parsimonious models (those with the lowest AICc) ranged between `r r2_values$r2c_min[r2_values$pollen_category == "conspecific_abs"]` and `r r2_values$r2c_max[r2_values$pollen_category == "conspecific_abs"]` (mean of `r r2_values$r2c_mean[r2_values$pollen_category == "conspecific_abs"]`) for the bootstrap replicates of the conspecific pollen models and between `r r2_values$r2c_min[r2_values$pollen_category == "heterospecific_abs"]` and `r r2_values$r2c_max[r2_values$pollen_category == "heterospecific_abs"]` (mean `r r2_values$r2c_mean[r2_values$pollen_category == "heterospecific_abs"]`) for the models of heterospecific pollen [@nakagawa_general_2013]. 
A large portion of this explanatory power came from the random effects, particularly for models of conspecific pollen. 
The marginal coefficient of determination R^2^~(m)~, which describes the proportion of variance explained for the fixed variables alone, ranged between `r r2_values$r2m_min[r2_values$pollen_category == "conspecific_abs"]` and `r r2_values$r2m_max[r2_values$pollen_category == "conspecific_abs"]` (mean `r r2_values$r2m_mean[r2_values$pollen_category == "conspecific_abs"]`) for the conspecific models and between `r r2_values$r2m_min[r2_values$pollen_category == "heterospecific_abs"]` and `r r2_values$r2m_max[r2_values$pollen_category == "heterospecific_abs"]` (mean `r r2_values$r2m_mean[r2_values$pollen_category == "heterospecific_abs"]`) for the heterospecific models. 

We tested two structures for the random effects. 
As determined by the AICc, the random structure best supported by the data was the one that fits an intercept for each species in a community independently (as opposed to an intercept for each species irrespective of the community they belong to). 
This structure was best for both the models of conspecific and heterospecific pollen (Table SXX).  

Out of the four variables we explored, we found that the plants' mean visit effectiveness and its abundance were the most important ecological variables predicting pollen deposition in plant stigmas (Figure \@ref(fig:fig-average-qual-quant)a). 
Surprisingly, the number of shared pollinators was comparatively unimportant, particularly for models of heterospecific pollen deposition, as it was only included in models with relatively large AICc values. 

We found that the relationship between each of the strategies and pollen deposition was similar for both conspecific and heterospecific pollen. 
This is, strategies that were associated with an increase (or a decrease) in conspecific pollen, were also associated with an increase (or a decrease) in heterospecific pollen deposition. 
Specifically, the plants' mean visit effectiveness had a positive effect on pollen deposition (Figure \@ref(fig:fig-average-qual-quant)b). 
The positive association with conspecific pollen indicates a positive effect on the quantity of pollination. 
However, the mean of the coefficients that relates visit effectiveness to heterospecific pollen deposition is slightly larger than that of conspecific pollen. 
This suggest a negative, albeit marginal, relationship of visit effectiveness and our definition of the quality of the pollination service (Figure \@ref(fig:fig-average-qual-quant)c). 
Contrastingly, the plants' relative abundance had a negative effect in pollen deposition (and consequently the quantity of pollination), but the difference between the coefficients in the models of conspecific and heterospecific pollen indicates a considerable positive impact on the quality of pollination. 
The third most important variable, functional originality, had a positive, although comparatively smaller, association with both the quantity and quality of pollination. 
Finally, the number of shared pollinators had a negative association with the quantity and quality of pollination, but these impacts were small when compared to the other variables. 
Although relative abundance, the number of shared pollinators, and the visit effectiveness were positively correlated (Figure \@ref(S-fig:fig-correlation)), the effect that each of them had on conspecific pollen was relatively similar among models that included all or just some of these three explanatory variables (Figure \@ref(S-fig:fig-model-results)). 

```{r fig-average-qual-quant, fig.height= 2.29, fig.width=6.5, fig.cap="**Effect of strategies to minimise competition in the pollination service**. (a) The plant's visit effectiveness and relative abundance are the most important variables determining the deposition of conspecific and heterospecific pollen. Meanwhile, the number of shared pollinators was relatively unimportant. The graph shows the relative variable importance calculated as the sum of the Akaike weights of the candidate models that included the variable. (b) The association of ecological variables on heterospecific pollen tended to be aligned with its association on conspecific pollen. Visit effectiveness and functional originality had a positive association with pollen deposition, while abundance and the number of shared pollinators had a negative association. The plot shows the distribution of the effects (across 99 bootstrap replicates) of the four ecological variables for conspecific (top panel) and heterospecific pollen (bottom panel). Results are only shown for models that included explanatory variable. (c) The end result of these associations is that only the plants' functional originality has a positive impact on both the quantity and quality of pollination. The plot shows the model averaged mean effect (± SE) of the four analysed ecological variables in the quantity and quality of pollination."}
height1 <- 1
height2 <- 1.29
# pdf(width = 3.25 * 2, height = sum(c(height1, height2)))
# fig_coef_avg <- plot_coefficient_averages(coefficient_averages, variable_importance)
width_imp <- 6.5/5*2
mult <- 2.455 # for 2/3 is xx, for 3/5 is 2.355
width_coef_1 <- (6.5 - width_imp) / (1 + mult)
width_coef_2 <- 5.6 - width_imp - width_coef_1
# fig_var_importance <- plot_variable_importance(variable_importance)
drake::loadd(fig_var_importance)
drake::loadd(fig_coef_avg)
drake::loadd(fig_coefficient_averages)

left_top <- cowplot::plot_grid(
  fig_var_importance[[1]],
  fig_var_importance[[2]],
  ncol = 2, 
  align = "h"
)

left_bottom <- cowplot::plot_grid(
  fig_coef_avg[[1]],
  fig_coef_avg[[2]],
  rel_widths = c(width_coef_1, width_coef_2), 
  align = "h"
)

left <- cowplot::plot_grid(
  left_top, 
  left_bottom, 
  ncol = 1, 
  rel_heights = c(height1, height2)
)

cowplot::plot_grid(
  left,
  fig_coefficient_averages, 
  ncol = 2,
  rel_widths = c(sum(c(width_coef_1, width_coef_2)), width_imp)
)
# dev.off()
```

## Flexibility of plant strategies

```{r pca-stats}
drake::loadd(pcas)
chosen_threshold <- 0
this_pca <- pcas %>%
    purrr::keep(~ .$call$X$pca_type[1] == "across") %>%
    purrr::keep(~ .$call$X$threshold[1] == chosen_threshold) %>%
    extract2(1)
```

We used a PCA of the analysed species to investigate whether plants strategies are similar across communities or whether they are flexible, and therefore able to adapt to the community context. 
The first two PCA components explained `r round(this_pca$eig[2, 3])`% of the total variance (Figure \@ref(fig:fig-pca)a). 
The first component was dominated by changes in the visit effectiveness and the relative abundance, while the second component was dominated by the number of shared pollinators and the plant's functional originality. 
When we locate the species that were sampled in more than one community in the first two PCA components (Figure \@ref(fig:fig-pca)b), we observe that the strategies of a species do not seem to be close to each other. 
Indeed, when we measured the median distance between the plants coordinates, we found that it was significantly smaller than that of randomisations for only one of all analysed species (Figure \@ref(fig:fig-pca)c). 

```{r strategy-fig-height}
height0 <- 1.55
height1 <- 2.7
height2 <- 2.4
strategy_fig_height <- sum(height0, height1, height2)
```

```{r fig-pca, fig.width=3.25, fig.height=strategy_fig_height, fig.cap="**The flexibility of plant strategies**. (a) The two first components explain a large proportion of the total variance. (b) When plants that were sampled in more than one community are plotted with these two components, we observe that points, which represent the strategy (the particular combination of ecological variables) of a species in a community do not seem to be grouped by plant species. (c) This was confirmed using Monte Carlo randomizations of the median distance between strategies of a plant species. Only one of the examined species had strategies that were more tightly connected than what would be expected at random."}
# fig_pca <- plot_pca(pcas, chosen_threshold = 0)
# fig_distances <- plot_permanova_dist(permanova_plant_distances, permanova_site_distances)
# fig_pca_contrib <- plot_pca_variances_and_contributions(pcas, chosen_threshold = 0)
# pdf(width = 3.25, height = strategy_fig_height)
drake::loadd(fig_pca_contrib)
drake::loadd(fig_pca)
drake::loadd(fig_distances)
cowplot::plot_grid(
  fig_pca_contrib,
  fig_pca, 
  fig_distances,
  ncol = 1, 
  rel_heights = c(height0, height1, height2), 
  align = "v"
)
# dev.off()
```

# Discussion 

Our results suggest that the community context plays a central role in determining competition for pollination. 
First, we found that the costs of pollinator sharing are pervasive. In particular, we found that a significant proportion of species undergoes overall neutral or competitive effects from animal-mediated pollination. 
Second, we found that plants are able to minimise the intensity of this competition using multiple strategies, however, conspecific and heterospecific pollen deposition are tightly coupled and therefore these strategies are likely to involve a trade-off between the quantity and quality of pollination. 
Third, we found that these strategies are strongly shaped by the community context, this is, the same plant species can adopt dramatically different strategies depending on the community it belongs to. 

\R{disc-facil-comp}Both of the tests we used to identify the effect of animal-mediated pollination suggested the same outcome: that overall facilitation is only experienced by a minority of species in a community. 
Although a recent study already suggested a wide range of outcomes in a multi-species context [@tur_evaluating_2016], the factors determining why some species experience more competition than others were not understood. 
Here we show that the prevalence of neutral and competitive effects of animal-mediated pollination can be, at least partially, explained by the trade-offs that minimising competition involves.  

These trade-offs were most evident precisely in the strategies that most strongly modulate pollen deposition. 
We found that the strategies that increased the relative dominance of the species (in terms of pollen and visits, or abundance) also tended to be the most important predictors of pollen deposition. 
Adopting a strategy of high visitation increases the rates of conspecific pollen deposition at the expense of a reduction in the quality of pollination even when the visitors carry a high proportion of conspecific pollen. 
Similarly, adopting a strategy of high abundance reduces the amount of heterospecific pollen deposited but at the expense of a noticeable reduction in the amount of conspecific pollen. 
Our results corroborate the importance that previous studies have attributed to the role that visitation and abundance play at determining competition for pollination [@feldman_when_2004; @munoz_presence_2008; @morales_interspecific_2008]. 
The fact that they also involve a trade-off between the quantity and quality of pollination might explain the often contrasting results that these studies, based on two or three species systems obtained. 

Simultaneously, because visitation, pollen production and abundance are correlated [@sargent_role_2006], the trade-offs also suggest that to minimise competition for pollination plants must reach a fine balance between increasing conspecific pollen and reduce heterospecific pollen deposition. 
The relatively wide range of coefficients in our models might be explained by the large variation of the extent to which plant species are affected by pollen deposition. 
While some plant species experience a large reduction on seed set due to heterospecific pollen deposition, some others are relatively insensitive to heterospecific pollen but are greatly affected by low levels of conspecific pollen deposition [@campbell_mechanism_1985]. 

The two other strategies we analysed involved a smaller trade-off than the abundance or visit efficacy. 
Specifically, having high functional originality relative to other species in the community or sharing few pollinators was found to be beneficial to both the quantity and quality of pollination.
Interestingly, these two strategies also had lower explanatory power in the models of pollen deposition. 
This does not necessarily imply that these variables are unimportant to pollen deposition. 
Instead, it is possible that the processes that underlay these strategies might be more complex than what our metrics are able to capture. 
Particularly so for conspecific pollen deposition, which was harder to predict than heterospecific pollen. 
For instance, having distinct traits, for example through phenology differentiation, might have a positive impact on the pollination service only to the extent to which previous floral communities have promoted high pollinator densities (ref). 
In addition, some plants have been shown possess mechanisms that prevent heterospecific pollen deposition even when shared visitors carry pollen loads from diverse species. 
Alternatively, other factors that we were unable to measure, like pollinator behaviour and densities [@ye_competition_2014; @flanagan_effects_2011; @melissas_2019?] or the spatial context [@cariveau_spatially_2009], can also shape the way sharing pollinators affect the pollination service. 

\R{strategies}Regardless of the specific factors involved it is clear, however, that the community context has a very important effect on the way plant species respond to competition for pollination. 
First, in the models of pollen deposition, the random structure that allowed plants of the same species to have different intercepts across communities was much better supported by the data than the structure that fixed the intercept for a plant species irrespective of the community. 
Second, in a large majority of cases, the strategies that a species uses across communities are not more similar to each other than what would be expected at random. 
Lit? Context?

## Conclusion



# Acknowledgements

`r paste(drake::readd(acknowledgements), collapse = "")`

# References
